# Encryptables Model

## Ausgangslage
Das Encryptabels Model soll die neue Struktur für die Realisierung mehrerer Verscheidener encryptables Typen sein. Diese verscheidenen Typen werden folgend nochmals erläutert. Encryptables sind flexibel und sind direkt an Ordner angehängt, wie es aktuell die Accounts sind.

## Anforderungen
Die Benutzer sollen nicht nur Ihre Accounts, sondern auch Ihre PINs, Tokens, Zertifikate und Secrets ablegen können. Vorrausetzung dazu ist eine klare Abgrenzung im Code. Damit diese gewährleistet ist, werden die Encryptables Models nach einer klaren definition aufgebaut.

## Verschlüsselung
Die Benutzerdaten der encryptables werden mit `AES256CBC` verschlüsselt, welches einen iv (initialization vector) wert Bietet. Konkret betrifft dies das `data`Attribut, in welchem sich die sensiblen Daten befinden.

## Model Klassen
![Encryptables Klassendiagramm](_diagrams/encryptables.png)

_Klassendiagramm mit neuer encryptable Struktur._

### Encryptable
Das Encryptable ist die Oberstruktur. Alle weiteren Encryptable Typen werden diese Klasse vererben. Damit wird eine Single Table Inhertiance erstellt. Damit diese Funktioniert erhält die Encryptable Oberklasse ein Attribut `type`, dieses definiert in den Subklassen den jeweiligen Encryptable Typ.

Weitere Attribute:

`name`: Der Name des Aktuellen Encryptable. Kann beispielsweise das Google Konto oder der API Key für einen Online service sein.

`description`: Die beschreibung des Encryptable

`type`: Definiert in den Subklassen den Encryptable typ. Wird Encryptable::File`, `Encryptable::Credentials` oder `Encryptable::OSESecret` sein.

`folder_id`: Diese definiert den Ordner, welchem das Encryptable zugehört.

Die beiden Methoden `encrypt()` und `decrypt()` werden verwendet um das encryptable zu ent- und verschlüsseln.

`data`: Dieses Attribut beinhaltet die sensiblen Benutzerdaten. Dabei gibt es drei Typen welche verschlüsselt werden, siehe [data](#data-attribut).

## Account
Der Account wird verwendet um Zugangsdaten zu einem Konto abzuspeichern.

Das Account Model wird neu zum `Encryptable::Account`

### Aktuell
Der Account existiert bereits. Zur Zeit wird dieser zum Abspeichern von Accountdaten, was der Email und dem Passwort entspricht verwendet. Der Account wird einem Ordner zugeordnet.

### Anforderungen
Der Account soll wie bisher Email und Passwort abspeichern können. Zusätzlich soll es möglich sein, dass Benutzer ihre eigenen Daten selbst erfassen können. Konkret soll man z.B. einen Benutzernamen erfassen können. Allgemein sollte der Account flexibler werden, damit Benutzer selber bestimmen können, was sie abspeichern möchten und was nicht.

## PIN
Die PIN ist die 'Persönliche Identifikationsnummer' und wird verwendet um z.B. Smartphones zu entsperren oder beim Bankomaten geld Abzuheben.

Das PIN Model wird neu zum `Encryptable::PIN`
### Aktuell
Das PIN Model existiert nicht.

### Anforderungen
Benutzer sollten mit dem encryptable PIN zahlenfolgen abspeichern können. 

## Secret
Das Secret definiert einen Zugangsschlüssel welcher eingesetzt werden kann ums sich bei Applikationen ausweisen zu können.

### Aktuell 
Das Secret Model existiert bereits als OSE-Secret.

### Anforderungen
Das Secret Model soll Benutzer weiterhin ermöglichen Secrets abzuspeichern, dieses soll in die neue encryptable Struktur eingegliedert werden.

## File
Das encryptable File soll Dateien vorzugsweise, Zertifikate speichern können. 

### Aktuell
Dieses Encryptable gibt es nicht. Es ist jedoch möglich Dateien in Cryptopus abzuspeichern.

## Anforderungen
Mit dem encryptable File sollen Benutzer die möglichkeit haben Dateien in Cryptopus verschlüsselt abzuspeichern.

## `data` Attribut
### Definition
Dieses Attribut beinhaltet die sensiblen Daten und wird mithilfe des Entsprechenden Encryptable in eine der Drei Subklassen verschlüsselt und gespeichert. 

**NOCH NACHLESEN OB SEPARATER IV FÜR JEDEN KEY**

### Encryptable::Credentials
Dieses Encryptable sieht vor, Daten in einem Key-Value Set zu verschlüsseln. Dies wird mithilfe von `EncryptedData::Credentials` gemacht.

```json
{
  "data": {
    "attributes": [
      {
        "key": "accountname",
        "value": "Google Konto",
        "iv": "secret-iv-value"
      },
      {
        "key": "password",
        "value": "example-password",
        "iv": "secret-iv-value"
      }
    ]
  }
}
```

### Encryptable::File
Dieses Encryptable sieht vor, Dateien welche base64 encoded sind, zu verschlüsseln. Dies wird mithilfe von `EncryptedData::Credentials` gemacht.

```json
{
  "data": {
    "attributes": [
      {
        "key": "file",
        "value": "Datei-base64-encoded",
        "iv": "secret-iv-value"
      }
    ]
  }
}
```

### Encryptable::Credentials
Dieses Encryptable sieht vor, Daten in einem Key-Value Set zu verschlüsseln. Dies wird mithilfe von `EncryptedData::File` gemacht.

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: test-secret
  namespace: my-namespace
type: Opaque
data:
  username: dmFsdWUtMQ0K
  password: dmFsdWUtMg0KDQo=
stringData:
  hostname: myapp.mydomain.com 
```


