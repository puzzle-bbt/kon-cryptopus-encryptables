# Migration

## Ausgangslage
Mit der neuen Struktur der encryptables fällt die aktuelle Accounts tabelle weg. Mittels einer Single Table Inheritance (STI) werden die submodels `Encryptable::File`, `Encryptable::Credentials` und `Encryptable::OSESecret` dem `Encryptable` zugeordnet.

## Datenbank
Die Datenbankmigration wird die aktuelle Accountstabelle umbenennen und dabei die neue Struktur für die Encryptables erstellen. Wichtig dabei ist das die Primary Keys der Accounts nicht verloren gehen. Zwecks Rückwärtskompatibiliät können damit auch alte API aufrufe den richtigen Accounts zugeordnet werden. Die Benutzerdaten werden mithilfe von zwei `EncryptedData` Klassen, der `EncryptedData::Credential` und `EncryptedData::File` verschlüsselt abgespeichert, dabei sollte der Datentyp Blob möglichst durch einen string Datentyp ersetzt werden.

## Benutzerdaten
Die Benutzerdaten werden migriert, sobald sich der Benutzer in der Applikation anmeldet. Danach wird geprüft, welche Teams dass bereits die neue Struktur der encryptables nutzen. Teams welche unter der alten Struktur abgespeichert sind, werden migriert (`Account` wird zu `Encryptable::Account`) und neu verschlüsselt.  